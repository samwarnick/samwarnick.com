# Block direct access to _meta
@meta {
    path /_meta/*
}
respond @meta 404

# Feed redirects
redir /feed.rss /rss.xml permanent
redir /styleguide /site/#styleguide

# Media - serve optimized formats via content negotiation
@media {
    path /media/*
}
  handle @media {
      # Try avif if client supports it and file exists
      @acceptsAvif {
          header Accept *image/avif*
          file {path}.avif
      }
      rewrite @acceptsAvif {path}.avif

      # Try webp if client supports it and file exists
      @acceptsWebp {
          header Accept *image/webp*
          file {path}.webp
      }
      rewrite @acceptsWebp {path}.webp

      header Cache-Control "public, max-age=2592000, immutable"
      file_server
  }

import _meta/redirects.caddy